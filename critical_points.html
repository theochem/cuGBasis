

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QTAIM Critical Points &mdash; cugbasis  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/override.css?v=064c4a14" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=9ba27866" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Non-Covalent Interaction Index" href="reduced_density_gradient.html" />
    <link rel="prev" title="Quick Start" href="quick_start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            cugbasis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#quick-installation">Quick-Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#detailed-installation">Detailed Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#downloading-code">Downloading Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#id3">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#python-binding">Python Binding</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#c">C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#compute-canada">Compute Canada</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-problems">Installation problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#building-documentation">Building Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="molecule.html">Molecule Class</a><ul>
<li class="toctree-l2"><a class="reference internal" href="molecule.html#cugbasis.Molecule"><code class="docutils literal notranslate"><span class="pre">Molecule</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.atcoords"><code class="docutils literal notranslate"><span class="pre">Molecule.atcoords</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.atnums"><code class="docutils literal notranslate"><span class="pre">Molecule.atnums</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_density"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_density()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_electrostatic_potential"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_electrostatic_potential()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_empirical_gradient_expansion_ked"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_empirical_gradient_expansion_ked()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_general_gradient_expansion_ked"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_general_gradient_expansion_ked()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_general_ked"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_general_ked()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_general_kinetic_energy_density"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_general_kinetic_energy_density()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_gradient"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_gradient()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_gradient_expansion_ked"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_gradient_expansion_ked()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_hessian"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_hessian()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_laplacian"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_laplacian()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_molecular_orbitals"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_molecular_orbitals()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_norm_of_vector"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_norm_of_vector()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_positive_definite_kinetic_energy_density"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_positive_definite_kinetic_energy_density()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_reduced_density_gradient"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_reduced_density_gradient()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_schrodinger_ked"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_schrodinger_ked()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_shannon_information_density"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_shannon_information_density()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_thomas_fermi_ked"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_thomas_fermi_ked()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.compute_weizsacker_ked"><code class="docutils literal notranslate"><span class="pre">Molecule.compute_weizsacker_ked()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.get_HOMO_index"><code class="docutils literal notranslate"><span class="pre">Molecule.get_HOMO_index()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.get_LUMO_index"><code class="docutils literal notranslate"><span class="pre">Molecule.get_LUMO_index()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.get_file_path"><code class="docutils literal notranslate"><span class="pre">Molecule.get_file_path()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.occs_a"><code class="docutils literal notranslate"><span class="pre">Molecule.occs_a</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Molecule.occs_b"><code class="docutils literal notranslate"><span class="pre">Molecule.occs_b</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="molecule.html#cugbasis.Promolecule"><code class="docutils literal notranslate"><span class="pre">Promolecule</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Promolecule.atcoords"><code class="docutils literal notranslate"><span class="pre">Promolecule.atcoords</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Promolecule.atnums"><code class="docutils literal notranslate"><span class="pre">Promolecule.atnums</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Promolecule.compute_density"><code class="docutils literal notranslate"><span class="pre">Promolecule.compute_density()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Promolecule.compute_esp"><code class="docutils literal notranslate"><span class="pre">Promolecule.compute_esp()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Promolecule.promol_coeffs"><code class="docutils literal notranslate"><span class="pre">Promolecule.promol_coeffs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="molecule.html#cugbasis.Promolecule.promol_exps"><code class="docutils literal notranslate"><span class="pre">Promolecule.promol_exps</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">Conventions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="conventions.html#gaussian-primitives">Gaussian Primitives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="conventions.html#cartesian">Cartesian</a></li>
<li class="toctree-l3"><a class="reference internal" href="conventions.html#spherical-pure">Spherical/Pure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="conventions.html#contractions">Contractions</a></li>
<li class="toctree-l2"><a class="reference internal" href="conventions.html#basis-set-groupings-shells">Basis-set Groupings (Shells)</a></li>
<li class="toctree-l2"><a class="reference internal" href="conventions.html#basis-set-ordering">Basis Set Ordering</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quick_start.html#Installation-cuGBasis-on-Colab">Installation cuGBasis on Colab</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#Enable-GPU">Enable GPU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quick_start.html#Constructing-Molecule-Object">Constructing Molecule Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick_start.html#Electron-Density">Electron Density</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#Molecular-Integration-and-Dipole-Moment">Molecular Integration and Dipole Moment</a></li>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#Isosurface-and-Cube-Files">Isosurface and Cube Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quick_start.html#Electron-Localization-Function-(ELF)">Electron Localization Function (ELF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick_start.html#Non-Covalent-Interactions-(NCI)">Non-Covalent Interactions (NCI)</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">QTAIM Critical Points</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Installation-cuGBasis-on-Colab">Installation cuGBasis on Colab</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Enable-GPU">Enable GPU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Load-the-Molecule">Load the Molecule</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-Default-Initial-Guess">Using Default Initial Guess</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Challenging-Cases">Challenging Cases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reduced_density_gradient.html">Non-Covalent Interaction Index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reduced_density_gradient.html#Constructing-Molecule-Object">Constructing Molecule Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="reduced_density_gradient.html#Reduced-Density-Gradient-Isosurface">Reduced Density Gradient Isosurface</a></li>
<li class="toctree-l2"><a class="reference internal" href="reduced_density_gradient.html#NCI-Index-Using-The-Hessian">NCI Index Using The Hessian</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="generating_cube_files.html">Generating Cube Files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="generating_cube_files.html#Density">Density</a></li>
<li class="toctree-l2"><a class="reference internal" href="generating_cube_files.html#Laplacian">Laplacian</a></li>
<li class="toctree-l2"><a class="reference internal" href="generating_cube_files.html#Reduced-Density-Gradient">Reduced Density Gradient</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cugbasis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">QTAIM Critical Points</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/critical_points.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><a class="reference external" href="https://colab.research.google.com/github/theochem/cuGBasis/blob/main/examples/critical_points.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<section id="QTAIM-Critical-Points">
<h1>QTAIM Critical Points<a class="headerlink" href="#QTAIM-Critical-Points" title="Link to this heading"></a></h1>
<p>This example illustrates how to find the QTAIM critical points and bond-paths using ChemTools and cuGBasis. This is precisely when the gradient of the electron density <span class="math notranslate nohighlight">\(\nabla \rho = 0\)</span> is zero. The first step is to load the wavefunction information using cuGBasis.</p>
<section id="Installation-cuGBasis-on-Colab">
<h2>Installation cuGBasis on Colab<a class="headerlink" href="#Installation-cuGBasis-on-Colab" title="Link to this heading"></a></h2>
<p>The user can skip this step if they aren’t using Google Colab.</p>
<p>Installation of cuGBasis is rather simple, given that the user has CMake, and CUDA installed.</p>
<section id="Enable-GPU">
<h3>Enable GPU<a class="headerlink" href="#Enable-GPU" title="Link to this heading"></a></h3>
<p>On Google Colab, the GPU needs to be enabled. The user should do the following:</p>
<p>Click on Runtime -&gt; Change runtime type -&gt; T4 GPU</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>#@title **Installing Horton, ChemTools and cuGBasis
#@markdown It may take a few minutes! Make sure to enable GPU
!pip install -q condacolab
import condacolab
condacolab.install()
!pip install numpy scipy pybind11 qc-iodata
!pip install git+https://github.com/theochem/grid.git
!mamba install -c theochem horton
!pip install git+https://github.com/theochem/chemtools.git@refs/pull/59/head
!git clone https://www.github.com/theochem/cuGBasis
!pip install -v qc-cugbasis
</pre></div>
</div>
</div>
</section>
</section>
<section id="Load-the-Molecule">
<h2>Load the Molecule<a class="headerlink" href="#Load-the-Molecule" title="Link to this heading"></a></h2>
<p>The first step is to load the wavefunction information using cuGBasis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>%cd ./cuGBasis/examples/
import cugbasis
import numpy as np

# Load the wavefunction information
fchk_path = &quot;./ALA_ALA_peptide_uwb97xd_def2svpd.fchk&quot;
mol = cugbasis.Molecule(fchk_path)

# Get the atomic coordinates and numbers
atom_coords = mol.atcoords
atom_numbers = mol.atnums
natoms = atom_coords.shape[0]
</pre></div>
</div>
</div>
</section>
<section id="Using-Default-Initial-Guess">
<h2>Using Default Initial Guess<a class="headerlink" href="#Using-Default-Initial-Guess" title="Link to this heading"></a></h2>
<p>In this example, we will provide only the atomic coordinates and it will generate initial guesses where the gradient of the electron density is close to zero. This should roughly be near the center of each atom, inbetween any two atoms and between three/four atoms. The electron density, gradient and hessian are obtained from cuGBasis and use is given to the ChemTools algorithm for efficiently finding the critical points and then find the bond-paths for all bond-critical points.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>from chemtools.topology.critical import Topology

dens_func = mol.compute_density
grad_func = mol.compute_gradient
hess_func = mol.compute_hessian

topo = Topology(dens_func, grad_func, hess_func, coords=atom_coords)
topo.find_critical_points_vectorized(atom_coords, use_log=True, verbose=True)

print(f&quot;Is Poincare-Hopf Equation Satisfied?:  {topo.poincare_hopf_equation}&quot;)
topo.find_bond_paths(tol=1e-8, max_ss=0.1)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Start Critical Points Finding.
Number of initial points: 7078
Iteration: 1,   Sum Gradient Norm of pts left: 13795.26664591485   Number of pts left: 7078
Iteration: 2,   Sum Gradient Norm of pts left: 16780.400882584137   Number of pts left: 6406
Iteration: 3,   Sum Gradient Norm of pts left: 8817.066657700365   Number of pts left: 5621
Iteration: 4,   Sum Gradient Norm of pts left: 6677.456524919042   Number of pts left: 5044
Iteration: 5,   Sum Gradient Norm of pts left: 7703.419316732867   Number of pts left: 4542
Iteration: 6,   Sum Gradient Norm of pts left: 5181.546111085325   Number of pts left: 3644
Iteration: 7,   Sum Gradient Norm of pts left: 3920.4795305932676   Number of pts left: 2636
Iteration: 8,   Sum Gradient Norm of pts left: 2872.2573213748974   Number of pts left: 1780
Iteration: 9,   Sum Gradient Norm of pts left: 1989.0294892860857   Number of pts left: 1171
Iteration: 10,   Sum Gradient Norm of pts left: 1207.2857892143145   Number of pts left: 750
Iteration: 11,   Sum Gradient Norm of pts left: 1365.7288943831077   Number of pts left: 500
Iteration: 12,   Sum Gradient Norm of pts left: 334.7816083341251   Number of pts left: 330
Iteration: 13,   Sum Gradient Norm of pts left: 1283.755969682446   Number of pts left: 219
Iteration: 14,   Sum Gradient Norm of pts left: 223.65822783103656   Number of pts left: 134
Iteration: 15,   Sum Gradient Norm of pts left: 156.539276677374   Number of pts left: 95
Iteration: 16,   Sum Gradient Norm of pts left: 35.491083921338465   Number of pts left: 68
Iteration: 17,   Sum Gradient Norm of pts left: 278.25726013961315   Number of pts left: 46
Iteration: 18,   Sum Gradient Norm of pts left: 2.790225722591271   Number of pts left: 32
Iteration: 19,   Sum Gradient Norm of pts left: 0.8964181432629607   Number of pts left: 20
Iteration: 20,   Sum Gradient Norm of pts left: 0.34165905752363   Number of pts left: 13
Iteration: 21,   Sum Gradient Norm of pts left: 0.17196361371146468   Number of pts left: 10
Iteration: 22,   Sum Gradient Norm of pts left: 0.1410298852305501   Number of pts left: 5
Iteration: 23,   Sum Gradient Norm of pts left: 0.06653078857485395   Number of pts left: 4
Iteration: 24,   Sum Gradient Norm of pts left: 0.0165977830289024   Number of pts left: 2
Iteration: 25,   Sum Gradient Norm of pts left: 5.4636591286238576e-05   Number of pts left: 1
Iteration: 26,   Sum Gradient Norm of pts left: 4.465092962324014e-10   Number of pts left: 1
Final number of points found 61
Is Poincare-Hopf Equation Satisfied?:  True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span># Grab the critical points
bcp = np.array([x.coordinate for x in topo.bcp])
nna = np.array([x.coordinate for x in topo.nna])
rcp = np.array([x.coordinate for x in topo.rcp])
ccp = np.array([x.coordinate for x in topo.ccp])

# Evaluate different properties on the critical points
lap_nna = mol.compute_laplacian(nna)
rdg_nna = mol.compute_reduced_density_gradient(nna)

# Get the bond paths from the fourth BCP
bond_pth1 = topo.bp[4][0]
bond_pth2 = topo.bp[4][1]
print(f&quot;Fourth bond critical point:    {topo.bcp[4].coordinate}&quot;)
print(f&quot;Initial bond path 1 point:     {bond_pth1[0]}&quot;)
print(f&quot;Initial bond path 2 point:     {bond_pth2[0]}&quot;)
# Check the final point is an atomic-coordinate
dist = np.linalg.norm(bond_pth1[-1] - atom_coords, axis=1)
index = np.where(dist &lt; 0.01)[0][0]
print(f&quot;Bond path 1 converged to atom {index} with coords {atom_coords[index]}&quot;)
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Fourth bond critical point:    [11.16293088 15.3014835   6.94768032]
Initial bond path 1 point:     [11.16292343 15.30138428  6.94769036]
Initial bond path 2 point:     [11.16293834 15.30158273  6.94767027]
Bond path 1 converged to atom 8 with coords [11.0737951  13.8082288   7.07513461]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>%matplotlib inline
import matplotlib.pyplot as plt

# Plot the critical points and bond paths
fig, ax = plt.subplots(1, 1, figsize=(10, 10), subplot_kw={&#39;projection&#39;: &#39;3d&#39;})
# Plot the bond paths
for i in range(0, len(topo.bcp)):
    for j in range(0, 2):
        p = topo.bp[i][j]
        ax.plot(p[:, 0], p[:, 1], p[:, 2], c=&quot;k&quot;, linewidth=1)
# Plot the critical points
if len(rcp) != 0:
    ax.scatter(rcp[:, 0], rcp[:, 1], rcp[:, 2], c=&quot;y&quot;, label=&quot;RCP&quot;, s=25)
if len(ccp) != 0:
    ax.scatter(ccp[:, 0], ccp[:, 1], ccp[:, 2], c=&quot;m&quot;, label=&quot;CCP&quot;, s=25)
ax.scatter(bcp[:, 0], bcp[:, 1], bcp[:, 2], c=&quot;b&quot;, label=&quot;BCP&quot;, s=50)
ax.scatter(nna[:, 0], nna[:, 1], nna[:, 2], c=&quot;r&quot;, label=&quot;(N)NA&quot;, s=50)
plt.legend(loc=&quot;lower center&quot;, shadow=True, fontsize=15, ncol=4, mode=&quot;expand&quot;) #
plt.title(&quot;QTAIM Critical Points and Bond Paths&quot;, fontsize=25)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/critical_points_10_0.png" src="_images/critical_points_10_0.png" />
</div>
</div>
</section>
<section id="Challenging-Cases">
<h2>Challenging Cases<a class="headerlink" href="#Challenging-Cases" title="Link to this heading"></a></h2>
<p>This example will illustrate a case, with a much large peptide, where the default initial guesses were not sufficient for finding all of the critical points. This can be determined from the Poincare-Hopf equation not being satisfied. In such scenario, the user will need to add more and better initial guesses.</p>
<p>This example will use <a class="reference external" href="https://grid.qcdevs.org/pyapi/grid.atomgrid.html">Grid</a> package to construct an Becke-Lebedev grid (Atomic Grid) around each atom. This is based on constructing grids over spherical coordinates <span class="math notranslate nohighlight">\((r, \theta, \phi)\)</span>, where a radial grid is constructed over the <span class="math notranslate nohighlight">\(r\)</span> coordinate and an angular grid over the <span class="math notranslate nohighlight">\((\theta, \phi)\)</span> coordinate. Due to the large size of the format check-point file, the user will need to use git lfs to download the file via the command
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span> <span class="pre">fetch</span> <span class="pre">--all</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>import cugbasis
import numpy as np

# Load the wavefunction information
fchk_path = &quot;./PHE_TRP_peptide_uwb97xd_def2svpd.fchk&quot;
mol = cugbasis.Molecule(fchk_path)

# Get the atomic coordinates and numbers
atom_coords = mol.atcoords
atom_numbers = mol.atnums
natoms = atom_coords.shape[0]
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>from grid.onedgrid import OneDGrid
from grid.atomgrid import AtomGrid

# Construct a radial grid will upper bound (1.5) and step-size (0.25)
#   to propogate out of each atom
u_bnd_rad = 1.5
ss_rad = 0.25
rad_grid = np.arange(0.0, u_bnd_rad, ss_rad)
rgrid = OneDGrid(points=rad_grid, weights=np.empty(rad_grid.shape))

# Construct a Becke-Lebedev grid around each atom using the
#    previous radial grid
atom_grids_list = []
for i in range(natoms):
    atomic_grid = AtomGrid.from_preset(
        10, preset=&quot;fine&quot;, rgrid=rgrid, center=atom_coords[i]
    )
    atom_grids_list.append(atomic_grid.points)

# Concatenate all of the points together to make the initial guess
pts = np.vstack(atom_grids_list)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>from chemtools.topology.critical import Topology

dens_func = mol.compute_density
grad_func = mol.compute_gradient
hess_func = mol.compute_hessian

topo = Topology(dens_func, grad_func, hess_func, coords=atom_coords, points=pts)
topo.find_critical_points_vectorized(atom_coords, use_log=True, verbose=False)

print(f&quot;Is Poincare-Hopf Equation Satisfied?:  {topo.poincare_hopf_equation}&quot;)
topo.find_bond_paths(tol=1e-8, max_ss=0.1)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Is Poincare-Hopf Equation Satisfied?:  True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>%matplotlib inline
import matplotlib.pyplot as plt

# Grab the critical points
bcp = np.array([x.coordinate for x in topo.bcp])
nna = np.array([x.coordinate for x in topo.nna])
rcp = np.array([x.coordinate for x in topo.rcp])
ccp = np.array([x.coordinate for x in topo.ccp])

# Plot the critical points and bond paths
fig, ax = plt.subplots(1, 1, figsize=(10, 10), subplot_kw={&#39;projection&#39;: &#39;3d&#39;})
# Plot the bond paths
for i in range(0, len(topo.bcp)):
    for j in range(0, 2):
        p = topo.bp[i][j]
        ax.plot(p[:, 0], p[:, 1], p[:, 2], c=&quot;k&quot;, linewidth=1)
# Plot the critical points
if len(rcp) != 0:
    ax.scatter(rcp[:, 0], rcp[:, 1], rcp[:, 2], c=&quot;y&quot;, label=&quot;RCP&quot;, s=25)
if len(ccp) != 0:
    ax.scatter(ccp[:, 0], ccp[:, 1], ccp[:, 2], c=&quot;m&quot;, label=&quot;CCP&quot;, s=25)
ax.scatter(bcp[:, 0], bcp[:, 1], bcp[:, 2], c=&quot;b&quot;, label=&quot;BCP&quot;, s=50)
ax.scatter(nna[:, 0], nna[:, 1], nna[:, 2], c=&quot;r&quot;, label=&quot;(N)NA&quot;, s=50)
plt.legend(loc=&quot;lower center&quot;, shadow=True, fontsize=15, ncol=4, mode=&quot;expand&quot;) #
plt.title(&quot;QTAIM Critical Points and Bond Paths&quot;, fontsize=25)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/critical_points_15_0.png" src="_images/critical_points_15_0.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quick_start.html" class="btn btn-neutral float-left" title="Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reduced_density_gradient.html" class="btn btn-neutral float-right" title="Non-Covalent Interaction Index" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, QC-Devs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>